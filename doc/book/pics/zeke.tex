\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

\definecolor{mybluei}{RGB}{124,156,205}
\definecolor{myblueii}{RGB}{73,121,193}
\definecolor{mygreen}{RGB}{202,217,126}
\definecolor{mypink}{RGB}{233,198,235}

% this length is used to control the width of the light blue frame
% for the upper part of the diagram
\newlength\myframesep
\setlength\myframesep{8pt}

\pgfkeys{
    /tikz/node distance/.append code={
        \pgfkeyssetvalue{/tikz/node distance value}{#1}
    }
}

\newcommand\widernode[5][blueb]{
\node[
        #1,
        inner sep=0pt,
        shift=($(#2.south)-(#2.north)$),
        yshift=-\pgfkeysvalueof{/tikz/node distance value},
        fit={(#2) (#3)},
        label=center:{\sffamily\bfseries\color{white}#4}] (#5) {};
}

\begin{tikzpicture}[node distance=3pt,outer sep=0pt,
blueb/.style={
  draw=white,
  fill=mybluei,
  rounded corners,
  text width=2.5cm,
  font={\sffamily\bfseries\color{white}},
  align=center,
  text height=12pt,
  text depth=9pt},
greenb/.style={blueb,fill=mygreen},
]
\node[blueb] (init) {init};
\node[blueb,right=of init] (usr) {User Program};
\widernode{init}{usr}{libc}{libc};
\widernode{libc}{libc}{Syscall Interface}{syscall};
\widernode{syscall}{syscall}{Kernel Core}{kernel};
\node[blueb, right=of kernel](vfs) {VFS};
\node[greenb,below=of kernel] (hal) {HAL};
\node[greenb,right=of hal] (drv) {Drivers};
\begin{pgfonlayer}{background}
\draw[blueb,draw=black,fill=mybluei!40] 
  ([xshift=-\myframesep,yshift=3\myframesep]current bounding box.north west) 
    rectangle 
  ([xshift=\myframesep,yshift=-\myframesep]current bounding box.south east);
\end{pgfonlayer}
\path  let \p1=( $ (syscall.east) - (syscall.west) $ )
 in node[blueb,inner xsep=0pt,draw=black,fill=myblueii,below=4pt of current bounding box.south,text width=\x1+2*\myframesep+2\pgflinewidth] (HW) {Hardware};
\node[font=\sffamily\itshape\color{white},above=of init] {Zeke};
\end{tikzpicture}