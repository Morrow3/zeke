\part{System calls}

\section{Introduction}
User scope stub wrappers are located in \verb+src/usrscope+ directory.
\verb+hal_core.h+ can be included to provide core specific system call
functions.

User scope syscall code is allowed to call following functions in \verb+hal_core+ to
implement syscall functionality:

\begin{itemize}
  \item \verb+uint32_t syscall(int type, void * p)+
  \item \verb+req_context_switch()+
\end{itemize}

\subsection{Syscall flow}

\begin{enumerate}
\item User scope thread makes a syscall by calling:
      \verb+syscall(SYSCALL_XXX_YYY, &args)+, where XXX is generally a
      module/compilation unit name, YYY is a function name and args is a
      syscall dataset structure in format specified in \verb+syscalldef.h+.

\item After interrupt handler and other hardware specific code execution enters
      to \verb+_intSyscall_handler()+ function where thread local \verb+errno+
      is first reset and then syscall handler of the correct compilation unit is
      resolved according to \verb+syscall_callmap+.

\item Execution enters to compilation unit specific \verb+XXX_syscall()+
      function where it is handled any way wanted, usually by switch...case
      structure and a function call.

\item \verb+XXX_syscall()+ returns a \verb+uint32_t+ value which is, after
      multiple return steps, returned back to the caller which should know
      what type the returned value actually represents.
\end{enumerate}


\subsection{Syscall Major and Minor codes}

Syscalls are divided to major and minor codes so that major codes represents a
set of functions related to each other, usually all the syscall functions in a
single compilation unit. Major number sets are internally called groups. Both
numbers are defined in \verb+syscall.h+ file.
