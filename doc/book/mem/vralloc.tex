\chapter{vralloc}

\acf{vralloc} is a memory allocator targeted to allocate blocks of memory
that will be mapped in virtual address space of a user processes.
\verb+vralloc+ returns a \verb+vm_region+ struct as a result of successful
memory allocation. This struct describes physical layout of the allocated
memory region while access permissions and virtual address are left to be
set by the caller.

\lstinputlisting[label=list:vregion,caption=vregion struct.]{mem/vregion_struct.c}

\begin{figure}
\begin{verbatim}
                      last_vreg
                               \
+----------------+     +-----------------+     +-------+
| .paddr = 0x100 |     | .paddr = 0x1500 |     |       |
| .count = 100   |<--->| -count = 20     |<--->|       |
|                |     |                 |     |       |
+----------------+     +-----------------+     +-------+
\end{verbatim}
\caption{vralloc blocks allocated from dynmem.}
\label{figure:vralloc_blocks}
\end{figure}